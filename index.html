<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Easy Chinese</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: auto; background: #fdfdfd; color: #333;}
    .dark { background: #222; color: #eee; }
    h1, h2 { text-align: center; }
    select, button, input { margin: 5px 0; padding: 8px; }
    .locked { background:#ffdddd; padding:10px; text-align:center; cursor:pointer; }
    #xpBar { background: orange; height: 10px; width:0; margin-top:5px;}
    .chatbox { margin-top:1em; }
    .chatbox div { margin: 4px 0; }
    canvas { margin-top: 20px; }
  </style>
</head>
<body>

<h1>Easy Chinese</h1>
<p style="text-align:center"><em>Master Chinese from HSK 1 to 9 effortlessly!</em></p>

<button onclick="toggleDarkMode()">Toggle Dark Mode</button>
<button onclick="buyCoffee()">☕ Buy Me A Coffee</button>

<h3>Your Streak: <span id="streak">0</span> 🔥</h3>
<h3>XP: <span id="xp">0</span></h3>
<div id="xpBar"></div>

<hr/>

<h2>Daily Boost</h2>
<p id="dailyWord"></p>
<p id="dailyGrammar"></p>

<hr/>

<h2>Choose HSK Level</h2>
<select id="levelSelect" onchange="changeLevel()">
  <option value="1">HSK 1</option>
  <option value="2">HSK 2</option>
  <option value="3">HSK 3</option>
  <option value="4">HSK 4</option>
  <option value="5">HSK 5</option>
  <option value="6">HSK 6 (PRO)</option>
  <option value="7">HSK 7 (PRO)</option>
  <option value="8">HSK 8 (PRO)</option>
  <option value="9">HSK 9 (PRO)</option>
</select>

<h2>Vocabulary</h2>
<div id="vocab"></div>

<h2>Grammar</h2>
<div id="grammar"></div>

<h2>Conversations</h2>
<div id="conversation"></div>

<h2>Quiz</h2>
<div id="quiz"></div>

<h2>Your Progress</h2>
<canvas id="progressChart" width="400" height="200"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const vocabData = {
  1: ["你好 (nǐ hǎo) - hello", "谢谢 (xièxiè) - thank you"],
  2: ["再见 (zàijiàn) - goodbye", "请问 (qǐngwèn) - may I ask"],
  3: ["因为 (yīnwèi) - because", "但是 (dànshì) - but"],
  4: ["虽然 (suīrán) - although", "为了 (wèile) - in order to"],
  5: ["竟然 (jìngrán) - unexpectedly", "无论 (wúlùn) - no matter"],
  6: ["与此同时 (yútóngshí) - meanwhile", "尚未 (shàngwèi) - not yet"],
  7: ["鉴于 (jiànyú) - in view of", "倘若 (tǎngruò) - if"],
  8: ["毋庸置疑 (wúyōng zhìyí) - undoubtedly", "何尝 (hécháng) - ever"],
  9: ["岂不是 (qǐ bú shì) - wouldn't it be", "尚且 (shàngqiě) - even"]
};

const grammarData = {
  1: ["S + 是 + N", "S + 有 + N"],
  2: ["S + 正在 + V", "S + 要 + V"],
  3: ["S + 一边 + V1 + 一边 + V2", "S + 虽然...但是..."],
  4: ["S + 为了 + V", "S + 先...然后..."],
  5: ["S + 既然...就...", "S + 不是...而是..."],
  6: ["S + 尽管...还是...", "S + 宁可...也不..."],
  7: ["S + 只要...就...", "S + 即使...也..."],
  8: ["S + 反而...", "S + 何况..."],
  9: ["S + 并非...", "S + 尚且...更何况..."]
};

const conversationsData = {
  1: ["A: 你好！ B: 你好！", "A: 谢谢你！ B: 不客气！"],
  2: ["A: 请问，这里有人吗？ B: 没有，你坐吧。"],
  3: ["A: 你为什么喜欢这里？ B: 因为很安静。"],
  4: ["A: 你先去，我等会来。 B: 好的。"],
  5: ["A: 既然你来了，就一起吃饭吧。"],
  6: ["A: 尽管很难，他还是坚持了下来。"],
  7: ["A: 只要努力，就会成功。"],
  8: ["A: 他不但不生气，反而笑了。"],
  9: ["A: 这尚且如此，更何况其他呢？"]
};

const chatbotReplies = {
  1: [{cn:"你好！", en:"Hello!"}, {cn:"你叫什么名字？", en:"What's your name?"}],
  2: [{cn:"请问你几岁？", en:"How old are you?"}],
  3: [{cn:"因为我喜欢中文。", en:"Because I like Chinese."}],
  4: [{cn:"你先说，然后我回答。", en:"You speak first, then I'll answer."}],
  5: [{cn:"既然你决定了，就去做吧。", en:"Since you've decided, go for it."}],
  6: [{cn:"尽管很难，我还是学下去了。", en:"Though it's hard, I kept learning."}],
  7: [{cn:"只要你努力，就一定成功。", en:"As long as you work hard, you'll succeed."}],
  8: [{cn:"他不但不生气，反而笑了。", en:"Not only did he not get angry, he even smiled."}],
  9: [{cn:"尚且如此，更何况其他。", en:"If even this is so, how about the rest?"}]
};

let xp = 0;
let streak = 0;
let lastVisit = localStorage.getItem("lastVisit") || "";
let today = new Date().toISOString().slice(0,10);

if (today !== lastVisit) {
  streak = parseInt(localStorage.getItem("streak") || "0") + 1;
  localStorage.setItem("streak", streak);
  localStorage.setItem("lastVisit", today);
}
document.getElementById("streak").innerText = streak;

function toggleDarkMode() {
  document.body.classList.toggle("dark");
}

function buyCoffee() {
  alert("Thanks for supporting us! Redirecting to BuyMeACoffee...");
  window.open("https://buymeacoffee.com/yourusername", "_blank");
}

function upgradePro() {
  alert("Upgrade to Easy Chinese Pro for $5/month to unlock all HSK levels, quizzes & coaching!");
}

function changeLevel() {
  const level = parseInt(document.getElementById("levelSelect").value);
  if (level >= 6) {
    document.getElementById("vocab").innerHTML = `<div class="locked" onclick="upgradePro()">🔒 Premium content. Click to upgrade.</div>`;
    document.getElementById("grammar").innerHTML = `<div class="locked" onclick="upgradePro()">🔒 Premium content. Click to upgrade.</div>`;
    document.getElementById("conversation").innerHTML = `<div class="locked" onclick="upgradePro()">🔒 Premium content. Click to upgrade.</div>`;
    document.getElementById("quiz").innerHTML = `<div class="locked" onclick="upgradePro()">🔒 Premium content. Click to upgrade.</div>`;
  } else {
    updateContent(level);
  }
}

function updateContent(level) {
  let v = vocabData[level].map(item=>`<li>${item}</li>`).join("");
  let g = grammarData[level].map(item=>`<li>${item}</li>`).join("");
  let c = conversationsData[level].map(item=>`<li>${item}</li>`).join("");
  document.getElementById("vocab").innerHTML = `<ul>${v}</ul>`;
  document.getElementById("grammar").innerHTML = `<ul>${g}</ul>`;
  document.getElementById("conversation").innerHTML = `<ul>${c}</ul>
    <div class="chatbox">
      <input id="chatInput" placeholder="Say something..." style="width:70%; padding:0.5em;">
      <button onclick="talkBot()">💬 Send</button>
      <div id="chatOutput" style="margin-top:0.5em;"></div>
    </div>`;
  document.getElementById("quiz").innerHTML = `<button onclick="addXP()">Take a quick quiz (+10 XP)</button>`;
}

function addXP() {
  xp += 10;
  localStorage.setItem("xp", xp);
  document.getElementById("xp").innerText = xp;
  document.getElementById("xpBar").style.width = xp + "px";
  drawChart();
}

function dailyTip() {
  let level = Math.ceil(Math.random()*9);
  let word = vocabData[level][0];
  let grammar = grammarData[level][0];
  document.getElementById("dailyWord").innerText = `Today's word (HSK ${level}): ${word}`;
  document.getElementById("dailyGrammar").innerText = `Today's grammar: ${grammar}`;
}

function drawChart() {
  let ctx = document.getElementById('progressChart').getContext('2d');
  new Chart(ctx, {
    type: 'line',
    data: {
      labels: Array(10).fill("").map((_,i)=>i+1),
      datasets: [{
        label: 'XP Growth',
        data: Array(10).fill(0).map(()=>Math.floor(Math.random()*xp)),
        borderColor: 'orange',
        tension: 0.3
      }]
    },
    options: { responsive: true, plugins: { legend: { display: false }}}
  });
}

function talkBot() {
  let userText = document.getElementById("chatInput").value;
  let level = parseInt(document.getElementById("levelSelect").value);
  let botSet = chatbotReplies[level] || chatbotReplies[1];
  let reply = botSet[Math.floor(Math.random()*botSet.length)];
  let outputDiv = document.getElementById("chatOutput");
  outputDiv.innerHTML += `<div><strong>You:</strong> ${userText}</div>`;
  outputDiv.innerHTML += `<div><strong>Bot:</strong> ${reply.cn} <small>(${reply.en})</small></div>`;
  document.getElementById("chatInput").value = "";
}

xp = parseInt(localStorage.getItem("xp") || "0");
document.getElementById("xp").innerText = xp;
document.getElementById("xpBar").style.width = xp + "px";
dailyTip();
drawChart();
changeLevel();
</script>
</body>
</html>